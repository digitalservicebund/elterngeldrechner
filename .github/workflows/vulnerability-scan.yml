name: Vulnerability Scan

on:
  schedule:
    - cron: 0 0 * * *
  workflow_dispatch:

jobs:
  scan-for-vulnerabilities:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@6e7b7d1fd3e4fef0c5fa8cce1229c54b2c9bd0d8
        with:
          scan-type: fs
          scan-ref: .
          format: sarif
          output: trivy-scan-result.sarif

      - name: Check for concerning vulnerabilies
        run: grep --quiet --extended-regexp 'HIGH|CRITICAL' trivy-scan-result.sarif && exit 1 || exit 0
